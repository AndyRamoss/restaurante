<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è Men√∫ Digital | Restaurante Delicias</title>
    <style>
        /* ========== ESTILOS PROFESIONALES ========== */
        :root {
            --primary: #D32F2F;
            --primary-dark: #B71C1C;
            --secondary: #FF9800;
            --success: #27AE60;
            --warning: #F39C12;
            --light: #F5F5F5;
            --dark: #333333;
            --gray: #757575;
            --danger: #E74C3C;
            --teal: #009688;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        .restaurant-header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .restaurant-header h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* MESA */
        .mesa-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 30px auto;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--success);
        }

        .mesa-numero {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        /* PRODUCTOS */
        .productos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .producto-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .producto-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .producto-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid var(--light);
        }

        .producto-content {
            padding: 20px;
        }

        .producto-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .producto-nombre {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            flex: 1;
        }

        .producto-precio {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-left: 15px;
        }

        .producto-desc {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 20px;
            min-height: 60px;
        }

        /* BOTONES */
        .btn-agregar {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--success), #2E7D32);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-agregar:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        /* CARRITO FLOTANTE */
        .carrito-flotante {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--secondary), #F57C00);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.3);
            z-index: 1000;
            font-size: 1.8rem;
            transition: all 0.3s;
        }

        .carrito-flotante:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(255, 152, 0, 0.4);
        }

        .carrito-contador {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
        }

        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 95%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 25px;
        }

        /* ITEMS DEL CARRITO */
        .carrito-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #EEE;
        }

        .item-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .item-precio {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cantidad-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cantidad-text {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
            font-size: 1.1rem;
        }

        .eliminar-btn {
            background: none;
            border: none;
            color: #FF5252;
            cursor: pointer;
            font-size: 1.3rem;
            padding: 5px;
        }

        /* TOTAL */
        .carrito-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 0;
            border-top: 3px solid #EEE;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* BOT√ìN CONFIRMAR */
        .btn-confirmar {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn-confirmar:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(211, 47, 47, 0.3);
        }

        .btn-confirmar:disabled {
            background: #CCC;
            cursor: not-allowed;
        }

        /* SEGUIMIENTO Y FACTURA */
        .seguimiento-container {
            margin-top: 30px;
            padding: 25px;
            background: #F8F9FA;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
        }

        .estado-actual {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
        }

        .progreso-bar {
            height: 10px;
            background: #E0E0E0;
            border-radius: 5px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progreso-fill {
            height: 100%;
            background: var(--primary);
            width: 25%;
            transition: width 0.5s ease, background 0.5s ease;
        }

        .estados-lista {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 10px;
        }

        .pedido-id {
            font-size: 0.9rem;
            color: var(--gray);
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #EEE;
        }

        /* FACTURA FINAL */
        .factura-final {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 2px solid var(--success);
        }

        .factura-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .factura-productos {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .producto-factura {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #DDD;
        }

        .producto-factura:last-child {
            border-bottom: none;
        }

        .factura-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }

        .btn-nuevo-pedido {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s;
        }

        .btn-nuevo-pedido:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(211, 47, 47, 0.3);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .productos-grid {
                grid-template-columns: 1fr;
            }
            
            .restaurant-header h1 {
                font-size: 2rem;
            }
            
            .carrito-flotante {
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- ESTRUCTURA HTML -->
    <div class="container">
        <!-- ENCABEZADO -->
        <header class="restaurant-header">
            <h1>üçΩÔ∏è RESTAURANTE DELICIAS</h1>
            <p style="color: var(--gray); margin-bottom: 20px;">Men√∫ Digital - Ordena desde tu mesa</p>
            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-weight: 600;">‚è∞</span>
                    <span>Abierto: 8:00 AM - 10:00 PM</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-weight: 600;">üìû</span>
                    <span>Reservas: (123) 456-7890</span>
                </div>
            </div>
        </header>

        <!-- SECCI√ìN MESA -->
        <section class="mesa-container" id="mesaContainer">
            <div style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;">ü™ë</div>
            <div class="mesa-numero" id="mesaNumero">MESA</div>
            <p style="color: var(--gray);">Todo lo que ordenes llegar√° directamente aqu√≠</p>
        </section>

        <!-- PRODUCTOS -->
        <section class="productos-grid" id="productosContainer">
            <!-- Los productos aparecer√°n aqu√≠ -->
        </section>

        <!-- CARRITO FLOTANTE -->
        <div class="carrito-flotante" onclick="abrirCarrito()">
            üõí
            <div class="carrito-contador" id="contadorCarrito">0</div>
        </div>
    </div>

    <!-- MODAL DEL CARRITO -->
    <div class="modal-overlay" id="modalCarrito">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; color: white;">üìã Tu Pedido</h2>
                <button onclick="cerrarCarrito()" 
                        style="background: none; border: none; color: white; font-size: 1.8rem; cursor: pointer; padding: 0 10px;">
                    √ó
                </button>
            </div>
            <div class="modal-body">
                <div class="mesa-container" style="margin: 0 0 25px 0; padding: 20px;">
                    <div class="mesa-numero" id="mesaActualCarrito">---</div>
                    <p style="color: var(--gray); font-size: 0.9rem;">Todo llegar√° a esta mesa</p>
                </div>

                <!-- ITEMS DEL CARRITO -->
                <div id="itemsCarrito"></div>

                <!-- TOTAL -->
                <div class="carrito-total">
                    <span>Total:</span>
                    <span id="totalCarrito">$0.00</span>
                </div>

                <!-- BOT√ìN CONFIRMAR -->
                <button class="btn-confirmar" onclick="confirmarPedido()" id="btnConfirmar" disabled>
                    ‚úÖ Enviar Pedido a Cocina
                </button>

                <!-- SEGUIMIENTO (oculto inicialmente) -->
                <div class="seguimiento-container" id="seguimientoPedido" style="display: none;">
                    <div id="contenidoSeguimiento">
                        <h3 style="margin-bottom: 20px; text-align: center; color: var(--dark);">üì± Seguimiento de tu Pedido</h3>
                        <div class="estado-actual" id="estadoActual">‚è≥ Recibido - En espera</div>
                        <div class="progreso-bar">
                            <div class="progreso-fill" id="progresoFill"></div>
                        </div>
                        <div class="estados-lista">
                            <span>Recibido</span>
                            <span>En cocina</span>
                            <span>Cocinando</span>
                            <span>Listo</span>
                        </div>
                        <div class="pedido-id">
                            <strong>ID Pedido:</strong> <span id="idPedido">---</span>
                        </div>
                    </div>
                </div>

                <!-- FACTURA FINAL (oculta inicialmente) -->
                <div class="factura-final" id="facturaFinal">
                    <div class="factura-header">
                        <div style="font-size: 3rem; margin-bottom: 15px; color: var(--success);">üéâ</div>
                        <h3 style="color: var(--primary); margin-bottom: 10px;">¬°Pedido Entregado!</h3>
                        <p style="color: var(--gray); font-size: 0.95rem;">Gracias por tu visita al Restaurante Delicias</p>
                    </div>

                    <div style="background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px dashed #DDD;">
                            <div>
                                <div style="color: var(--gray); font-size: 0.9rem;">Mesa</div>
                                <div style="font-weight: 700; font-size: 1.2rem;" id="facturaMesa">---</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--gray); font-size: 0.9rem;">ID Pedido</div>
                                <div style="font-weight: 700; font-size: 1.1rem;" id="facturaId">---</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Hora</div>
                            <div style="font-weight: 600;" id="facturaHora">---</div>
                        </div>
                    </div>

                    <div class="factura-productos">
                        <h4 style="color: var(--dark); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <span>üçΩÔ∏è</span> Detalle del Pedido
                        </h4>
                        <div id="facturaProductos">
                            <!-- Los productos aparecer√°n aqu√≠ -->
                        </div>
                    </div>

                    <div class="factura-total">
                        <span>TOTAL</span>
                        <span id="facturaTotal">$0.00</span>
                    </div>

                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: #FFF8E1; border-radius: 10px; border-left: 4px solid var(--secondary);">
                        <p style="color: #F57C00; font-weight: 600; margin-bottom: 10px;">
                            <span>‚≠ê</span> ¬°Esperamos verte pronto!
                        </p>
                        <p style="color: #666; font-size: 0.9rem;">
                            Tu satisfacci√≥n es nuestra prioridad
                        </p>
                    </div>

                    <button class="btn-nuevo-pedido" onclick="window.location.reload()">
                        üçΩÔ∏è Realizar Nuevo Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT FUNCIONAL -->
    <script>
        // ============================================
        // CONFIGURACI√ìN - USA TU NUEVA URL
        // ============================================
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbw8o6OYujVvrviDh0n7tRe2r1BdTTaPhMsbT_WUe72banavN2sJ-YYXxFANBRfAqIgP/exec';
        
        // ============================================
        // DATOS DEL MEN√ö
        // ============================================
        const PRODUCTOS = [
            {
                id: 1,
                nombre: "Nachos Supreme",
                descripcion: "Nachos con queso derretido, guacamole, jalape√±os y carne molida",
                precio: 12.99,
                categoria: "entradas",
                imagen: "https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 2,
                nombre: "Hamburguesa Deluxe",
                descripcion: "Carne 250g, queso cheddar, tocino, lechuga y tomate",
                precio: 18.99,
                categoria: "principales",
                imagen: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 3,
                nombre: "Ensalada C√©sar",
                descripcion: "Lechuga romana, pollo grill√©, croutons y aderezo c√©sar",
                precio: 14.75,
                categoria: "ensaladas",
                imagen: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 4,
                nombre: "Pizza Margarita",
                descripcion: "Pizza cl√°sica con salsa de tomate, mozzarella y albahaca",
                precio: 16.50,
                categoria: "principales",
                imagen: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 5,
                nombre: "Tacos al Pastor",
                descripcion: "3 tacos con carne adobada, pi√±a, cebulla y cilantro",
                precio: 13.99,
                categoria: "principales",
                imagen: "https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 6,
                nombre: "Cheesecake de Fresa",
                descripcion: "Torta de queso con salsa de fresas naturales",
                precio: 9.99,
                categoria: "postres",
                imagen: "https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 7,
                nombre: "Refresco 500ml",
                descripcion: "Coca-Cola, Sprite, Fanta o T√≥nica",
                precio: 4.50,
                categoria: "bebidas",
                imagen: "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?w=400&h=300&fit=crop&auto=format"
            },
            {
                id: 8,
                nombre: "Agua Mineral",
                descripcion: "Agua purificada 600ml",
                precio: 3.00,
                categoria: "bebidas",
                imagen: "https://images.unsplash.com/photo-1523362628745-0c100150b504?w=400&h=300&fit=crop&auto=format"
            }
        ];

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let carrito = [];
        let pedidoConfirmado = false;
        let idPedidoActual = null;
        let mesaActual = null;
        let pedidoData = null;

        // ============================================
        // 1. INICIALIZAR MEN√ö
        // ============================================
        function inicializar() {
            console.log('üöÄ Iniciando men√∫ digital...');
            
            const params = new URLSearchParams(window.location.search);
            mesaActual = params.get('mesa') || '1';
            
            document.getElementById('mesaNumero').textContent = `MESA ${mesaActual}`;
            document.getElementById('mesaActualCarrito').textContent = `MESA ${mesaActual}`;
            
            cargarProductos();
            
            console.log('‚úÖ Men√∫ listo para la mesa', mesaActual);
        }

        // ============================================
        // 2. CARGAR PRODUCTOS
        // ============================================
        function cargarProductos() {
            const container = document.getElementById('productosContainer');
            container.innerHTML = '';
            
            PRODUCTOS.forEach(producto => {
                const card = document.createElement('div');
                card.className = 'producto-card';
                card.innerHTML = `
                    <img src="${producto.imagen}" alt="${producto.nombre}" class="producto-img">
                    <div class="producto-content">
                        <div class="producto-header">
                            <h3 class="producto-nombre">${producto.nombre}</h3>
                            <div class="producto-precio">$${producto.precio.toFixed(2)}</div>
                        </div>
                        <p class="producto-desc">${producto.descripcion}</p>
                        <button class="btn-agregar" onclick="agregarAlCarrito(${producto.id})">
                            <span style="font-size: 1.2rem;">+</span> Agregar al Pedido
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ============================================
        // 3. AGREGAR AL CARRITO
        // ============================================
        function agregarAlCarrito(idProducto) {
            if (pedidoConfirmado) {
                mostrarNotificacion('No puedes modificar el pedido despu√©s de confirmar', 'error');
                return;
            }
            
            const producto = PRODUCTOS.find(p => p.id === idProducto);
            const itemExistente = carrito.find(item => item.id === idProducto);
            
            if (itemExistente) {
                itemExistente.cantidad++;
            } else {
                carrito.push({
                    id: producto.id,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: 1
                });
            }
            
            actualizarContadorCarrito();
            mostrarNotificacion(`‚úÖ ${producto.nombre} agregado`, 'success');
        }

        // ============================================
        // 4. ACTUALIZAR CONTADOR
        // ============================================
        function actualizarContadorCarrito() {
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            document.getElementById('contadorCarrito').textContent = totalItems;
            document.getElementById('btnConfirmar').disabled = carrito.length === 0;
        }

        // ============================================
        // 5. ABRIR/CERRAR CARRITO
        // ============================================
        function abrirCarrito() {
            document.getElementById('modalCarrito').style.display = 'flex';
            renderizarCarrito();
        }

        function cerrarCarrito() {
            document.getElementById('modalCarrito').style.display = 'none';
        }

        // ============================================
        // 6. MOSTRAR CARRITO
        // ============================================
        function renderizarCarrito() {
            const container = document.getElementById('itemsCarrito');
            const totalSpan = document.getElementById('totalCarrito');
            
            if (carrito.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üõí</div>
                        <h3 style="color: #666; margin-bottom: 10px;">Tu carrito est√° vac√≠o</h3>
                        <p>Agrega productos desde el men√∫</p>
                    </div>
                `;
                totalSpan.textContent = '$0.00';
                return;
            }
            
            let html = '';
            let total = 0;
            
            carrito.forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;
                
                html += `
                    <div class="carrito-item">
                        <div class="item-info">
                            <h4>${item.nombre}</h4>
                            <div class="item-precio">$${item.precio.toFixed(2)} c/u</div>
                        </div>
                        <div class="item-controls">
                            <button class="cantidad-btn" onclick="modificarCantidad(${index}, -1)">‚àí</button>
                            <span class="cantidad-text">${item.cantidad}</span>
                            <button class="cantidad-btn" onclick="modificarCantidad(${index}, 1)">+</button>
                            <button class="eliminar-btn" onclick="eliminarItem(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            totalSpan.textContent = `$${total.toFixed(2)}`;
        }

        // ============================================
        // 7. MODIFICAR CANTIDAD
        // ============================================
        function modificarCantidad(index, cambio) {
            if (pedidoConfirmado) {
                mostrarNotificacion('No puedes modificar el pedido despu√©s de confirmar', 'error');
                return;
            }
            
            carrito[index].cantidad += cambio;
            
            if (carrito[index].cantidad <= 0) {
                carrito.splice(index, 1);
            }
            
            actualizarContadorCarrito();
            renderizarCarrito();
        }

        // ============================================
        // 8. ELIMINAR PRODUCTO
        // ============================================
        function eliminarItem(index) {
            if (pedidoConfirmado) {
                mostrarNotificacion('No puedes modificar el pedido despu√©s de confirmar', 'error');
                return;
            }
            
            if (confirm('¬øEliminar este producto del pedido?')) {
                carrito.splice(index, 1);
                actualizarContadorCarrito();
                renderizarCarrito();
            }
        }

        // ============================================
        // 9. CONFIRMAR PEDIDO - VERSI√ìN SIMPLE QUE S√ç FUNCIONA
        // ============================================
        async function confirmarPedido() {
            if (carrito.length === 0) {
                mostrarNotificacion('Agrega productos al carrito primero', 'error');
                return;
            }
            
            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            idPedidoActual = 'PED-' + Date.now().toString().slice(-6);
            const codigoConfirmacion = Math.floor(1000 + Math.random() * 9000);
            
            // Crear resumen
            let resumen = `üìã RESUMEN DE PEDIDO\n\n`;
            resumen += `Mesa: ${mesaActual}\n`;
            resumen += `ID: ${idPedidoActual}\n\n`;
            
            carrito.forEach(item => {
                resumen += `${item.cantidad}x ${item.nombre}\n`;
            });
            
            resumen += `\nüí∞ TOTAL: $${total.toFixed(2)}\n`;
            resumen += `üî¢ C√≥digo: ${codigoConfirmacion}\n`;
            
            if (!confirm(resumen + '\n¬øEnviar pedido a cocina?')) return;
            
            try {
                console.log('üì§ Enviando pedido...');
                
                // Preparar datos SIMPLES
                const pedidoParaEnviar = {
                    action: 'crearPedido',
                    id: idPedidoActual,
                    mesa: mesaActual,
                    productos: carrito.map(item => `${item.cantidad}x ${item.nombre}`).join(', '),
                    total: total,
                    codigo: codigoConfirmacion.toString()
                };
                
                // Enviar como form data simple
                const formData = new URLSearchParams();
                for (const key in pedidoParaEnviar) {
                    formData.append(key, pedidoParaEnviar[key]);
                }
                
                const respuesta = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                });
                
                const resultado = await respuesta.json();
                console.log('üìÑ Respuesta del servidor:', resultado);
                
                if (resultado.success) {
                    mostrarNotificacion(`‚úÖ Pedido #${idPedidoActual} enviado a cocina`, 'success');
                    procesarConfirmacionExitosa();
                } else {
                    mostrarNotificacion(`‚ùå Error: ${resultado.message || 'No se pudo guardar'}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n:', error);
                mostrarNotificacion('Error de conexi√≥n con el servidor', 'error');
            }
        }

        // ============================================
        // 10. PROCESAR CONFIRMACI√ìN EXITOSA
        // ============================================
        function procesarConfirmacionExitosa() {
            pedidoConfirmado = true;
            document.getElementById('btnConfirmar').disabled = true;
            document.getElementById('btnConfirmar').innerHTML = '‚úÖ Pedido Enviado';
            document.getElementById('btnConfirmar').style.background = '#4CAF50';
            
            // Mostrar seguimiento
            document.getElementById('seguimientoPedido').style.display = 'block';
            document.getElementById('idPedido').textContent = idPedidoActual;
            
            // Guardar datos localmente
            pedidoData = {
                id: idPedidoActual,
                mesa: mesaActual,
                productos: carrito.map(item => `${item.cantidad}x ${item.nombre}`).join(', '),
                total: carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0),
                codigo: Math.floor(1000 + Math.random() * 9000)
            };
            
            // Limpiar carrito
            carrito = [];
            actualizarContadorCarrito();
            renderizarCarrito();
            
            // Mostrar alerta
            setTimeout(() => {
                alert(`‚úÖ PEDIDO CONFIRMADO\n\nID: ${idPedidoActual}\n\nEl pedido ha sido enviado a cocina.`);
            }, 500);
        }

        // ============================================
        // 11. MOSTRAR NOTIFICACIONES
        // ============================================
        function mostrarNotificacion(mensaje, tipo) {
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${tipo === 'error' ? '#f44336' : '#4CAF50'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            notificacion.innerHTML = `
                <span style="font-size: 1.2rem;">${tipo === 'error' ? '‚ùå' : '‚úÖ'}</span>
                <span>${mensaje}</span>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }

        // ============================================
        // 12. INICIALIZAR AL CARGAR
        // ============================================
        window.onload = inicializar;

        // Cerrar modal al hacer click fuera
        window.onclick = function(event) {
            const modal = document.getElementById('modalCarrito');
            if (event.target === modal) {
                cerrarCarrito();
            }
        };

        // Agregar animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>