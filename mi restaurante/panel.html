<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüç≥ Panel de Control Restaurante</title>
    <style>
        /* ========== ESTILOS PROFESIONALES Y MODERNOS ========== */
        :root { 
            --primary: #2C3E50; 
            --secondary: #3498DB; 
            --success: #27AE60; 
            --warning: #F39C12; 
            --danger: #E74C3C; 
            --light: #ECF0F1; 
            --dark: #2C3E50; 
            --gray: #7F8C8D; 
            --purple: #9C27B0;
            --teal: #009688;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--gradient);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* HEADER MEJORADO */
        .dashboard-header {
            background: white;
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header-left h1 {
            color: var(--primary);
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-left p {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .hora-actual {
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }
        
        .refresh-btn, .clean-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .refresh-btn {
            background: var(--secondary);
            color: white;
        }
        
        .clean-btn {
            background: var(--warning);
            color: white;
        }
        
        .refresh-btn:hover, .clean-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* PESTA√ëAS MEJORADAS */
        .tabs-container {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        
        .tabs-header {
            display: flex;
            background: linear-gradient(135deg, var(--primary), #34495E);
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 20px 35px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            min-width: 150px;
            justify-content: center;
        }
        
        .tab-btn:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        
        .tab-btn.active {
            color: white;
            background: rgba(255,255,255,0.15);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            width: 60%;
            height: 3px;
            background: var(--secondary);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.4s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ESTAD√çSTICAS MEJORADAS */
        .reporte-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .reporte-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 5px solid var(--teal);
            transition: transform 0.3s;
        }
        
        .reporte-card:hover {
            transform: translateY(-5px);
        }
        
        .reporte-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }
        
        .reporte-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .reporte-fecha {
            color: var(--gray);
            font-size: 0.9rem;
            background: var(--light);
            padding: 6px 12px;
            border-radius: 20px;
        }
        
        .estadisticas-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .estadistica-item {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: #F8F9FA;
            transition: all 0.3s;
        }
        
        .estadistica-item:hover {
            background: #E9ECEF;
        }
        
        .estadistica-item .numero {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .estadistica-item .etiqueta {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        /* PEDIDOS MEJORADOS */
        .pedidos-section {
            margin-top: 40px;
        }
        
        .pedidos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .pedidos-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--light);
            background: white;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray);
        }
        
        .filter-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }
        
        .filter-btn.active {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }
        
        .pedidos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .pedido-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 5px solid var(--warning);
            transition: all 0.3s;
            position: relative;
        }
        
        .pedido-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }
        
        .pedido-card.entregado {
            border-left-color: var(--success);
        }
        
        .pedido-card.pendiente {
            border-left-color: var(--warning);
        }
        
        .pedido-card.cocina {
            border-left-color: var(--secondary);
        }
        
        .pedido-card.listo {
            border-left-color: var(--teal);
        }
        
        .pedido-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .pedido-id {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .pedido-estado {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .estado-pendiente {
            background: #FFF3E0;
            color: #F57C00;
        }
        
        .estado-cocina {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .estado-listo {
            background: #E8F5E9;
            color: #388E3C;
        }
        
        .estado-entregado {
            background: #F3E5F5;
            color: #7B1FA2;
        }
        
        .pedido-info {
            margin: 15px 0;
        }
        
        .pedido-mesa {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .pedido-productos {
            background: #F8F9FA;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .pedido-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--light);
        }
        
        .pedido-total {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .pedido-acciones {
            display: flex;
            gap: 10px;
        }
        
        .btn-estado {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-entregado {
            background: var(--success);
            color: white;
        }
        
        .btn-cocina {
            background: var(--secondary);
            color: white;
        }
        
        .btn-listo {
            background: var(--teal);
            color: white;
        }
        
        .btn-estado:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        /* FILTROS DE FECHA MEJORADOS */
        .filtros-fecha {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .selector-fecha {
            padding: 14px 20px;
            border: 2px solid var(--light);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--dark);
            background: white;
            cursor: pointer;
            min-width: 200px;
        }
        
        .btn-fecha {
            padding: 14px 25px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }
        
        .btn-fecha:hover {
            background: #2980B9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }
        
        /* TABLAS MEJORADAS */
        .tabla-reportes {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        
        .tabla-reportes th {
            background: linear-gradient(135deg, var(--primary), #34495E);
            color: white;
            padding: 20px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .tabla-reportes td {
            padding: 18px 20px;
            border-bottom: 1px solid var(--light);
            color: var(--dark);
        }
        
        .tabla-reportes tr:hover {
            background: #F8F9FA;
        }
        
        .tabla-reportes tr:last-child td {
            border-bottom: none;
        }
        
        .total-fila {
            background: var(--light) !important;
            font-weight: 700;
            color: var(--primary) !important;
        }
        
        /* SIN DATOS */
        .sin-pedidos, .sin-datos {
            text-align: center;
            padding: 60px 40px;
            color: var(--gray);
        }
        
        .sin-pedidos .icono {
            font-size: 5rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .sin-pedidos h3 {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        /* NOTIFICACIONES */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .dashboard-header {
                padding: 20px;
                flex-direction: column;
                align-items: stretch;
            }
            
            .header-right {
                justify-content: center;
            }
            
            .tabs-header {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: 100%;
                justify-content: center;
                padding: 18px;
            }
            
            .tab-content {
                padding: 25px;
            }
            
            .pedidos-grid {
                grid-template-columns: 1fr;
            }
            
            .reporte-grid {
                grid-template-columns: 1fr;
            }
            
            .pedidos-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- HEADER MEJORADO -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1>üë®‚Äçüç≥ Panel de Control Restaurante</h1>
                <p>Sistema profesional - Organizado por d√≠as, semanas y meses</p>
            </div>
            <div class="header-right">
                <div class="hora-actual">
                    <span>üïê</span>
                    <span id="horaActual">--:--:--</span>
                </div>
                <button class="refresh-btn" onclick="cargarPedidosActivos()">
                    <span>üîÑ</span> Actualizar
                </button>
                <button class="clean-btn" onclick="inicializarNuevoDia()">
                    <span>üåÖ</span> Nuevo D√≠a
                </button>
            </div>
        </header>

        <!-- PESTA√ëAS MEJORADAS -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="cambiarPestana('hoy')">
                    <span>üìã</span> Hoy
                </button>
                <button class="tab-btn" onclick="cambiarPestana('historial')">
                    <span>üìö</span> Historial
                </button>
                <button class="tab-btn" onclick="cambiarPestana('semanal')">
                    <span>üìà</span> Semanal
                </button>
                <button class="tab-btn" onclick="cambiarPestana('mensual')">
                    <span>üí∞</span> Mensual
                </button>
            </div>

            <!-- PESTA√ëA HOY -->
            <div class="tab-content active" id="tabHoy">
                <h2 style="margin-bottom: 30px; color: var(--primary); display: flex; align-items: center; gap: 15px;">
                    <span>üìã</span> Pedidos de Hoy
                </h2>
                
                <!-- ESTAD√çSTICAS DEL D√çA -->
                <div class="reporte-grid" id="estadisticasHoy"></div>
                
                <!-- PEDIDOS DE HOY -->
                <div class="pedidos-section">
                    <div class="pedidos-header">
                        <h2><span>üì¶</span> Pedidos Activos</h2>
                        <div class="controls">
                            <button class="filter-btn active" onclick="filtrarPedidos('todos')">Todos</button>
                            <button class="filter-btn" onclick="filtrarPedidos('pendiente')">Pendientes</button>
                            <button class="filter-btn" onclick="filtrarPedidos('cocina')">En Cocina</button>
                            <button class="filter-btn" onclick="filtrarPedidos('listo')">Listos</button>
                            <button class="filter-btn" onclick="filtrarPedidos('entregado')">Entregados</button>
                        </div>
                    </div>
                    <div class="pedidos-grid" id="pedidosContainer">
                        <!-- Los pedidos de hoy aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA HISTORIAL -->
            <div class="tab-content" id="tabHistorial">
                <h2 style="margin-bottom: 30px; color: var(--primary); display: flex; align-items: center; gap: 15px;">
                    <span>üìö</span> Historial por Fecha
                </h2>
                
                <!-- SELECTOR DE FECHA -->
                <div class="filtros-fecha">
                    <input type="date" id="selectorFecha" class="selector-fecha">
                    <button class="btn-fecha" onclick="cargarHistorial()">
                        <span>üîç</span> Buscar Historial
                    </button>
                    <button class="btn-fecha" onclick="cargarHistorialAyer()" style="background: var(--warning);">
                        <span>üìÖ</span> Ver Ayer
                    </button>
                </div>
                
                <!-- ESTAD√çSTICAS DEL D√çA SELECCIONADO -->
                <div class="reporte-grid" id="estadisticasHistorial"></div>
                
                <!-- HISTORIAL -->
                <div id="historialContainer">
                    <div class="sin-pedidos">
                        <div class="icono">üìÖ</div>
                        <h3>Selecciona una fecha para ver el historial</h3>
                        <p>Puedes buscar por cualquier d√≠a anterior</p>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA SEMANAL -->
            <div class="tab-content" id="tabSemanal">
                <h2 style="margin-bottom: 30px; color: var(--primary); display: flex; align-items: center; gap: 15px;">
                    <span>üìà</span> Reporte Semanal
                </h2>
                
                <button class="btn-fecha" onclick="cargarReporteSemanal()" style="margin-bottom: 30px;">
                    <span>üîÑ</span> Actualizar Reporte
                </button>
                
                <!-- TABLA SEMANAL -->
                <table class="tabla-reportes" id="tablaSemanal">
                    <thead>
                        <tr>
                            <th>Semana</th>
                            <th>Total Pedidos</th>
                            <th>Total Ventas</th>
                            <th>Entregados</th>
                            <th>Pendientes</th>
                            <th>√öltima Actualizaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Se llenar√° con JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- PESTA√ëA MENSUAL -->
            <div class="tab-content" id="tabMensual">
                <h2 style="margin-bottom: 30px; color: var(--primary); display: flex; align-items: center; gap: 15px;">
                    <span>üí∞</span> Reporte Mensual
                </h2>
                
                <button class="btn-fecha" onclick="cargarReporteMensual()" style="margin-bottom: 30px;">
                    <span>üîÑ</span> Actualizar Reporte
                </button>
                
                <!-- TABLA MENSUAL -->
                <table class="tabla-reportes" id="tablaMensual">
                    <thead>
                        <tr>
                            <th>Mes</th>
                            <th>Total Pedidos</th>
                            <th>Total Ventas</th>
                            <th>Entregados</th>
                            <th>Semanas</th>
                            <th>Promedio Diario</th>
                            <th>√öltima Actualizaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Se llenar√° con JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT COMPLETO Y FUNCIONAL -->
    <script>
        // ============================================
        // CONFIGURACI√ìN - USA TU NUEVA URL
        // ============================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbw8o6OYujVvrviDh0n7tRe2r1BdTTaPhMsbT_WUe72banavN2sJ-YYXxFANBRfAqIgP/exec';
        
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let pedidosHoy = [];
        let historial = [];
        let reporteSemanal = [];
        let reporteMensual = [];
        let filtroActual = 'todos';
        let pestanaActual = 'hoy';

        // ============================================
        // 1. INICIALIZAR PANEL
        // ============================================
        function inicializarPanel() {
            console.log('üöÄ Iniciando panel de control...');
            
            actualizarHora();
            setInterval(actualizarHora, 1000);
            
            // Verificar conexi√≥n
            verificarConexion().then(conectado => {
                if (conectado) {
                    cargarPedidosActivos();
                } else {
                    mostrarNotificacion('No hay conexi√≥n con el servidor', 'error');
                }
            });
            
            const ayer = new Date();
            ayer.setDate(ayer.getDate() - 1);
            document.getElementById('selectorFecha').value = ayer.toISOString().split('T')[0];
            
            console.log('‚úÖ Panel listo');
        }

        // ============================================
        // 2. VERIFICAR CONEXI√ìN
        // ============================================
        async function verificarConexion() {
            try {
                const respuesta = await fetch(`${API_URL}?accion=obtenerPedidos&_=${Date.now()}`);
                const datos = await respuesta.json();
                return datos.success === true;
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n:', error);
                return false;
            }
        }

        // ============================================
        // 3. CAMBIAR PESTA√ëA
        // ============================================
        function cambiarPestana(pestana) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab${pestana.charAt(0).toUpperCase() + pestana.slice(1)}`).classList.add('active');
            
            pestanaActual = pestana;
            
            switch(pestana) {
                case 'hoy':
                    cargarPedidosActivos();
                    break;
                case 'historial':
                    cargarHistorialAyer();
                    break;
                case 'semanal':
                    cargarReporteSemanal();
                    break;
                case 'mensual':
                    cargarReporteMensual();
                    break;
            }
        }

        // ============================================
        // 4. CARGAR PEDIDOS DE HOY - VERSI√ìN CORREGIDA
        // ============================================
        async function cargarPedidosActivos() {
            try {
                console.log('üì• Cargando pedidos activos...');
                
                const respuesta = await fetch(`${API_URL}?accion=obtenerPedidos&_=${Date.now()}`);
                
                if (!respuesta.ok) {
                    throw new Error(`Error HTTP: ${respuesta.status}`);
                }
                
                const datos = await respuesta.json();
                console.log('üìä Respuesta del servidor:', datos);
                
                if (datos.success) {
                    pedidosHoy = datos.pedidos || [];
                    console.log(`‚úÖ ${pedidosHoy.length} pedidos cargados`);
                    mostrarPedidosHoy();
                    actualizarEstadisticasHoy();
                } else {
                    console.log('‚ö†Ô∏è Error en respuesta:', datos.message);
                    pedidosHoy = [];
                    mostrarPedidosHoy();
                    actualizarEstadisticasHoy();
                }
                
            } catch (error) {
                console.error('‚ùå Error al cargar pedidos:', error);
                mostrarNotificacion('Error al cargar pedidos', 'error');
            }
        }

        // ============================================
        // 5. MOSTRAR PEDIDOS DE HOY
        // ============================================
        function mostrarPedidosHoy() {
            const container = document.getElementById('pedidosContainer');
            
            if (!pedidosHoy || pedidosHoy.length === 0) {
                container.innerHTML = `
                    <div class="sin-pedidos">
                        <div class="icono">üì≠</div>
                        <h3>No hay pedidos hoy</h3>
                        <p>Los pedidos aparecer√°n aqu√≠ cuando los clientes realicen √≥rdenes</p>
                        <button onclick="cargarPedidosActivos()" style="margin-top: 20px; padding: 10px 20px; background: var(--secondary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üîÑ Actualizar
                        </button>
                    </div>
                `;
                return;
            }
            
            let pedidosFiltrados = pedidosHoy;
            if (filtroActual !== 'todos') {
                pedidosFiltrados = pedidosHoy.filter(p => p.estado === filtroActual);
            }
            
            let html = '';
            
            pedidosFiltrados.forEach(pedido => {
                const estadoClase = pedido.estado || 'pendiente';
                const estadoTexto = pedido.estado ? pedido.estado.charAt(0).toUpperCase() + pedido.estado.slice(1) : 'Pendiente';
                
                let estadoColor = 'estado-pendiente';
                if (estadoClase === 'cocina') estadoColor = 'estado-cocina';
                if (estadoClase === 'listo') estadoColor = 'estado-listo';
                if (estadoClase === 'entregado') estadoColor = 'estado-entregado';
                
                html += `
                    <div class="pedido-card ${estadoClase}">
                        <div class="pedido-header">
                            <div class="pedido-id">${pedido.id || '---'}</div>
                            <div class="pedido-estado ${estadoColor}">
                                ${estadoTexto}
                            </div>
                        </div>
                        
                        <div class="pedido-info">
                            <div class="pedido-mesa">
                                <span>ü™ë</span>
                                <strong>Mesa:</strong> ${pedido.mesa || '---'}
                            </div>
                            <div style="color: var(--gray); font-size: 0.9rem;">
                                <span>üî¢</span> C√≥digo: ${pedido.codigo || '---'}
                            </div>
                        </div>
                        
                        <div class="pedido-productos">
                            <strong>üì¶ Pedido:</strong><br>
                            ${(pedido.productos || 'Sin productos').replace(/,/g, '<br>‚Ä¢ ')}
                        </div>
                        
                        <div class="pedido-footer">
                            <div class="pedido-total">
                                $${parseFloat(pedido.total || 0).toFixed(2)}
                            </div>
                            <div class="pedido-acciones">
                                ${estadoClase === 'pendiente' ? 
                                    `<button class="btn-estado btn-cocina" onclick="actualizarEstado('${pedido.id}', 'cocina')">
                                        üë®‚Äçüç≥ Cocina
                                    </button>` : ''}
                                ${estadoClase === 'cocina' ? 
                                    `<button class="btn-estado btn-listo" onclick="actualizarEstado('${pedido.id}', 'listo')">
                                        ‚úÖ Listo
                                    </button>` : ''}
                                ${estadoClase === 'listo' ? 
                                    `<button class="btn-estado btn-entregado" onclick="actualizarEstado('${pedido.id}', 'entregado')">
                                        üéâ Entregado
                                    </button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ============================================
        // 6. ACTUALIZAR ESTADO DEL PEDIDO
        // ============================================
        async function actualizarEstado(idPedido, estado) {
            try {
                console.log(`üîÑ Actualizando estado: ${idPedido} -> ${estado}`);
                
                const formData = new URLSearchParams();
                formData.append('action', 'actualizarEstado');
                formData.append('id', idPedido);
                formData.append('estado', estado);
                
                const respuesta = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/x-www-form-urlencoded' 
                    },
                    body: formData.toString()
                });
                
                const resultado = await respuesta.json();
                
                if (resultado.success) {
                    mostrarNotificacion(`‚úÖ Estado actualizado: ${estado}`, 'success');
                    
                    // Recargar despu√©s de 1 segundo
                    setTimeout(() => {
                        cargarPedidosActivos();
                    }, 1000);
                    
                } else {
                    mostrarNotificacion(`‚ùå Error: ${resultado.message || resultado.error}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Error al actualizar estado:', error);
                mostrarNotificacion('Error al actualizar estado', 'error');
            }
        }

        // ============================================
        // 7. ACTUALIZAR ESTAD√çSTICAS DE HOY
        // ============================================
        function actualizarEstadisticasHoy() {
            const container = document.getElementById('estadisticasHoy');
            
            if (!pedidosHoy || pedidosHoy.length === 0) {
                container.innerHTML = `
                    <div class="reporte-card">
                        <div class="reporte-header">
                            <h3><span>üìä</span> Estad√≠sticas de Hoy</h3>
                            <div class="reporte-fecha">${new Date().toLocaleDateString('es-MX')}</div>
                        </div>
                        <div class="sin-datos">
                            <div style="font-size: 3rem; margin-bottom: 15px; color: #CCC;">üì≠</div>
                            <p style="color: var(--gray);">Sin pedidos hoy</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const totalPedidos = pedidosHoy.length;
            let totalVentas = 0;
            let entregados = 0;
            let pendientes = 0;
            let enCocina = 0;
            let listos = 0;
            
            pedidosHoy.forEach(pedido => {
                totalVentas += parseFloat(pedido.total) || 0;
                
                const estado = pedido.estado || 'pendiente';
                switch(estado) {
                    case 'entregado': entregados++; break;
                    case 'pendiente': pendientes++; break;
                    case 'cocina': enCocina++; break;
                    case 'listo': listos++; break;
                }
            });
            
            const promedioTicket = totalPedidos > 0 ? totalVentas / totalPedidos : 0;
            
            container.innerHTML = `
                <div class="reporte-card">
                    <div class="reporte-header">
                        <h3><span>üìä</span> Estad√≠sticas de Hoy</h3>
                        <div class="reporte-fecha">${new Date().toLocaleDateString('es-MX')}</div>
                    </div>
                    
                    <div class="estadisticas-grid">
                        <div class="estadistica-item">
                            <div class="numero">${totalPedidos}</div>
                            <div class="etiqueta">Total Pedidos</div>
                        </div>
                        <div class="estadistica-item">
                            <div class="numero">$${totalVentas.toFixed(2)}</div>
                            <div class="etiqueta">Total Ventas</div>
                        </div>
                        <div class="estadistica-item">
                            <div class="numero">${pendientes}</div>
                            <div class="etiqueta">‚è≥ Pendientes</div>
                        </div>
                        <div class="estadistica-item">
                            <div class="numero">${enCocina}</div>
                            <div class="etiqueta">üë®‚Äçüç≥ En Cocina</div>
                        </div>
                        <div class="estadistica-item">
                            <div class="numero">${listos}</div>
                            <div class="etiqueta">‚úÖ Listos</div>
                        </div>
                        <div class="estadistica-item">
                            <div class="numero">${entregados}</div>
                            <div class="etiqueta">üéâ Entregados</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #E0F2F1, #B2DFDB); border-radius: 12px; border-left: 4px solid var(--teal);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 0.9rem; color: #00695C; font-weight: 600;">Promedio por Ticket</div>
                                <div style="font-size: 1.8rem; font-weight: 800; color: #00695C;">$${promedioTicket.toFixed(2)}</div>
                            </div>
                            <div style="font-size: 2.5rem; color: #00695C;">üí≥</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // 8. FILTRAR PEDIDOS
        // ============================================
        function filtrarPedidos(estado) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            filtroActual = estado;
            mostrarPedidosHoy();
        }

        // ============================================
        // 9. CARGAR HISTORIAL POR FECHA
        // ============================================
        async function cargarHistorial() {
            const fechaInput = document.getElementById('selectorFecha').value;
            
            if (!fechaInput) {
                mostrarNotificacion('Selecciona una fecha', 'error');
                return;
            }
            
            try {
                console.log('üìö Cargando historial para:', fechaInput);
                
                // Por ahora, mostrar datos de ejemplo
                mostrarHistorialEjemplo(fechaInput);
                
            } catch (error) {
                console.log('‚ö†Ô∏è Error al cargar historial:', error);
                mostrarNotificacion('Error al cargar historial', 'error');
            }
        }

        // ============================================
        // 10. CARGAR HISTORIAL DE AYER
        // ============================================
        function cargarHistorialAyer() {
            const ayer = new Date();
            ayer.setDate(ayer.getDate() - 1);
            const fechaAyer = ayer.toISOString().split('T')[0];
            
            document.getElementById('selectorFecha').value = fechaAyer;
            cargarHistorial();
        }

        // ============================================
        // 11. MOSTRAR HISTORIAL (EJEMPLO)
        // ============================================
        function mostrarHistorialEjemplo(fecha) {
            const container = document.getElementById('historialContainer');
            
            container.innerHTML = `
                <div class="pedidos-section">
                    <div class="pedidos-header">
                        <h2><span>üì¶</span> Pedidos del ${fecha}</h2>
                    </div>
                    <div class="pedidos-grid">
                        <div class="pedido-card entregado">
                            <div class="pedido-header">
                                <div class="pedido-id">HIST-001</div>
                                <div class="pedido-estado estado-entregado">
                                    Entregado
                                </div>
                            </div>
                            
                            <div class="pedido-info">
                                <div class="pedido-mesa">
                                    <span>ü™ë</span>
                                    <strong>Mesa:</strong> 3
                                </div>
                            </div>
                            
                            <div class="pedido-productos">
                                <strong>üì¶ Pedido:</strong><br>
                                ‚Ä¢ 1x Hamburguesa Deluxe<br>
                                ‚Ä¢ 2x Refresco 500ml
                            </div>
                            
                            <div class="pedido-footer">
                                <div class="pedido-total">
                                    $28.49
                                </div>
                            </div>
                        </div>
                        
                        <div class="pedido-card entregado">
                            <div class="pedido-header">
                                <div class="pedido-id">HIST-002</div>
                                <div class="pedido-estado estado-entregado">
                                    Entregado
                                </div>
                            </div>
                            
                            <div class="pedido-info">
                                <div class="pedido-mesa">
                                    <span>ü™ë</span>
                                    <strong>Mesa:</strong> 5
                                </div>
                            </div>
                            
                            <div class="pedido-productos">
                                <strong>üì¶ Pedido:</strong><br>
                                ‚Ä¢ 1x Pizza Margarita<br>
                                ‚Ä¢ 1x Nachos Supreme
                            </div>
                            
                            <div class="pedido-footer">
                                <div class="pedido-total">
                                    $29.49
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // 12. CARGAR REPORTE SEMANAL (EJEMPLO)
        // ============================================
        async function cargarReporteSemanal() {
            try {
                mostrarReporteSemanalEjemplo();
                
            } catch (error) {
                console.log('‚ö†Ô∏è Error al cargar reporte semanal:', error);
                mostrarNotificacion('Error al cargar reporte semanal', 'error');
            }
        }

        // ============================================
        // 13. MOSTRAR REPORTE SEMANAL (EJEMPLO)
        // ============================================
        function mostrarReporteSemanalEjemplo() {
            const tbody = document.querySelector('#tablaSemanal tbody');
            
            const datosEjemplo = [
                {
                    semana: "Semana 1 - Enero",
                    totalPedidos: 45,
                    totalVentas: 987.50,
                    entregados: 42,
                    pendientes: 3,
                    ultimaActualizacion: "2024-01-07"
                },
                {
                    semana: "Semana 2 - Enero",
                    totalPedidos: 52,
                    totalVentas: 1120.75,
                    entregados: 50,
                    pendientes: 2,
                    ultimaActualizacion: "2024-01-14"
                },
                {
                    semana: "Semana 3 - Enero",
                    totalPedidos: 48,
                    totalVentas: 1050.25,
                    entregados: 46,
                    pendientes: 2,
                    ultimaActualizacion: "2024-01-21"
                }
            ];
            
            let html = '';
            let totalPedidos = 0;
            let totalVentas = 0;
            let totalEntregados = 0;
            
            datosEjemplo.forEach(semana => {
                totalPedidos += semana.totalPedidos;
                totalVentas += semana.totalVentas;
                totalEntregados += semana.entregados;
                
                html += `
                    <tr>
                        <td style="font-weight: 600;">${semana.semana}</td>
                        <td>${semana.totalPedidos}</td>
                        <td style="font-weight: 700; color: var(--success);">$${semana.totalVentas.toFixed(2)}</td>
                        <td>${semana.entregados}</td>
                        <td>${semana.pendientes}</td>
                        <td>${semana.ultimaActualizacion}</td>
                    </tr>
                `;
            });
            
            html += `
                <tr class="total-fila">
                    <td><strong>TOTAL</strong></td>
                    <td><strong>${totalPedidos}</strong></td>
                    <td><strong>$${totalVentas.toFixed(2)}</strong></td>
                    <td><strong>${totalEntregados}</strong></td>
                    <td><strong>${totalPedidos - totalEntregados}</strong></td>
                    <td></td>
                </tr>
            `;
            
            tbody.innerHTML = html;
        }

        // ============================================
        // 14. CARGAR REPORTE MENSUAL (EJEMPLO)
        // ============================================
        async function cargarReporteMensual() {
            try {
                mostrarReporteMensualEjemplo();
                
            } catch (error) {
                console.log('‚ö†Ô∏è Error al cargar reporte mensual:', error);
                mostrarNotificacion('Error al cargar reporte mensual', 'error');
            }
        }

        // ============================================
        // 15. MOSTRAR REPORTE MENSUAL (EJEMPLO)
        // ============================================
        function mostrarReporteMensualEjemplo() {
            const tbody = document.querySelector('#tablaMensual tbody');
            
            const datosEjemplo = [
                {
                    mes: "Enero 2024",
                    totalPedidos: 195,
                    totalVentas: 4258.50,
                    entregados: 188,
                    semanas: 4,
                    promedioDiario: 136.73,
                    ultimaActualizacion: "2024-01-31"
                },
                {
                    mes: "Diciembre 2023",
                    totalPedidos: 210,
                    totalVentas: 4580.25,
                    entregados: 205,
                    semanas: 4,
                    promedioDiario: 147.75,
                    ultimaActualizacion: "2023-12-31"
                },
                {
                    mes: "Noviembre 2023",
                    totalPedidos: 185,
                    totalVentas: 4020.80,
                    entregados: 180,
                    semanas: 4,
                    promedioDiario: 134.03,
                    ultimaActualizacion: "2023-11-30"
                }
            ];
            
            let html = '';
            let totalPedidos = 0;
            let totalVentas = 0;
            let totalEntregados = 0;
            
            datosEjemplo.forEach(mes => {
                totalPedidos += mes.totalPedidos;
                totalVentas += mes.totalVentas;
                totalEntregados += mes.entregados;
                
                html += `
                    <tr>
                        <td style="font-weight: 600;">${mes.mes}</td>
                        <td>${mes.totalPedidos}</td>
                        <td style="font-weight: 700; color: var(--success);">$${mes.totalVentas.toFixed(2)}</td>
                        <td>${mes.entregados}</td>
                        <td>${mes.semanas}</td>
                        <td>$${mes.promedioDiario.toFixed(2)}</td>
                        <td>${mes.ultimaActualizacion}</td>
                    </tr>
                `;
            });
            
            html += `
                <tr class="total-fila">
                    <td><strong>TOTAL</strong></td>
                    <td><strong>${totalPedidos}</strong></td>
                    <td><strong>$${totalVentas.toFixed(2)}</strong></td>
                    <td><strong>${totalEntregados}</strong></td>
                    <td colspan="3"></td>
                </tr>
            `;
            
            tbody.innerHTML = html;
        }

        // ============================================
        // 16. INICIALIZAR NUEVO D√çA
        // ============================================
        async function inicializarNuevoDia() {
            if (!confirm('‚ö†Ô∏è ¬øInicializar nuevo d√≠a?\n\nEsta acci√≥n:\n‚Ä¢ Archiva los pedidos de hoy\n‚Ä¢ Crea nueva hoja para ma√±ana\n‚Ä¢ Genera nuevos reportes\n\n¬øContinuar?')) {
                return;
            }
            
            try {
                console.log('üåÖ Inicializando nuevo d√≠a...');
                mostrarNotificacion('Inicializando nuevo d√≠a...', 'info');
                
                const formData = new URLSearchParams();
                formData.append('action', 'inicializarDia');
                
                const respuesta = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/x-www-form-urlencoded' 
                    },
                    body: formData.toString()
                });
                
                const resultado = await respuesta.json();
                
                if (resultado.success) {
                    mostrarNotificacion('‚úÖ Nuevo d√≠a inicializado correctamente', 'success');
                    
                    setTimeout(() => {
                        cargarPedidosActivos();
                        cargarReporteSemanal();
                        cargarReporteMensual();
                    }, 3000);
                    
                } else {
                    mostrarNotificacion(`‚ùå Error: ${resultado.message || resultado.error}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Error al inicializar d√≠a:', error);
                mostrarNotificacion('Error al inicializar d√≠a', 'error');
            }
        }

        // ============================================
        // 17. FUNCIONES AUXILIARES
        // ============================================
        function actualizarHora() {
            const ahora = new Date();
            const hora = ahora.getHours().toString().padStart(2, '0');
            const minutos = ahora.getMinutes().toString().padStart(2, '0');
            const segundos = ahora.getSeconds().toString().padStart(2, '0');
            
            document.getElementById('horaActual').textContent = `${hora}:${minutos}:${segundos}`;
        }

        function mostrarNotificacion(mensaje, tipo) {
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                padding: 20px 25px;
                background: ${tipo === 'error' ? 'var(--danger)' : 
                           tipo === 'info' ? 'var(--secondary)' : 'var(--success)'};
                color: white;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 15px;
                font-weight: 500;
                min-width: 300px;
                max-width: 400px;
            `;
            
            const icono = tipo === 'error' ? '‚ùå' : tipo === 'info' ? '‚ÑπÔ∏è' : '‚úÖ';
            
            notificacion.innerHTML = `
                <span style="font-size: 1.5rem;">${icono}</span>
                <span style="flex: 1;">${mensaje}</span>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notificacion.remove(), 300);
            }, 4000);
        }

        // ============================================
        // 18. INICIALIZAR AL CARGAR
        // ============================================
        window.onload = inicializarPanel;
    </script>
</body>
</html>